# Парсинг новостного сайта (на примере SecurityLab)

### main.py:

1. Устанавливаем requests, bs4 и lxml;
2. Создаём словарь заголовков - headers и ссылку на ресурс - url;
3. В переменную r передаём параметры get-запроса;
4. Создаём объект soup - с параметрами: (результат запроса, "парсер")
5. Соберём в список articles_cards все теги "a" с классом "article-card" - отвечает за карточку с новостью (они одинаковые у каждой карточки) при помощи soup.find_all()
6. Пробежимся в цикле по карточкам со статьями и соберём нужную нам информацию:
                * название статьи,
                * дату публикации,
                * краткое описание,
                * ссылку
7. Забираем поочередно в цикле:
            * название статьи (article_title): article.find("h2", class_="article-card-title")
            * описание (article_desc): article.find("p")
            * ссылку (article_url): f'https://www.securitylab.ru{article.get("href")}'
            * дату публикации (article_date_time): article.find("time").get("datetime")
8. Преобразуем дату публикации с помощью модулей time и datetime в более удобную
9. Делаем первый промежуточный вывод, чтобы посмотреть - что мы спарсили
10. Заберём ID-новости из ссылки на статью (смотреть test_ID_news.py)
11. Создадим словарь для наших статей (news_dict) и на каждой итерации он будет заполняться, ключом будет ID-новости а значениями - собранные данные
12. Результат работы сохраним в JSON-файл
13. Создаём функцию main и условие
14. Создадим функцию для условия проверки новостей на обновление (check_news_update)
15. Прочитаем и сохраним словарь в переменную (news_dict) и сделаем второй промежуточный вывод
16. Копируем и вставляем в функцию заголовки и get-запросы
17. Создаём цикл for и пробегаемся в нём по карточкам
18. Копируем (article_url) и (article_id) из первой функции
19. Пишем if(если ID уже есть в словаре) и else(если ID - нету)
20. Если ID - нету, то собираем все данные как в первой функции (копируем их оттуда)
21. И добавить новую новость в словарь (news_dict) (пример показан в test_new_news_dict.py)
22. Создадим словарь только для новых новостей (fresh_news)
23. И в конце сохраним это всё в новый JSON-файл
24. Возвращать же функция будет словарь со свежими новостями в конце
25. Новая новость добавилась в JSON-файл

### bot_main.py:

1. Устанавливаем и импортируем библиотеку aiogram
2. Создаём config.py - для хранения токена бота (токен можно получить у BotFathera при создании бота)
3. Создаём экземпляры bota и dp - диспетчера
4. Создаём тренировочную функцию ответа на команду (/start): async def start() и декоратор с обработкой комнады: @dp.message_handler("start")
5. Запускаем бота через: 
                                                        if __name__ == '__main__':
                                                            executor.start_polling(dp)
     Бот работает
6. Создаём функцию сбора новостей с обработкой команды @dp.message_handler("all_news")
7. Подгрузим словарь с новостями из JSON-файла и импортируем json
8. Пишем цикл for и пробегаемся по словарю news_dict (sorted() - вернёт новости в возрастающем порядке)
9. В переменную news сохраняем дату публикации, заголовок, описание и ссылку на статью
10. Отправляем ответ (с новостями) пользователю: await message.answer()
11. Импортируем методы для форматирования from aiogram.utils.markdown
12. Раскрасим выводы в news: hbold() - дату создания, 
                                                    hunderline() - заголовок,
                                                    hcode() - описание,
                                                    hlink() - ссылка (зашивает ссылку в текст(первый аргумент - строка куда её вшить, второй аргумент - ссылка))
13. Напишем функцию для получения 5 последних новостей: get_last_five_news(), выполняющаяся по команде: /last_five_news
14. Создаём функцию получения свежей новости: get_fresh_news(), с командой: /fresh_news
15. Импортируем из main.py функцию check_news_update() и сохраняем результат её работы в fresh_news
16. Напишем условие проверки, если длина словаря >= 1, то в нём находятся свежие новости, то проходим по нему циклом for и возвращаем новинки новостей на экран пользователю
17. Иначе выводим надпись, о том что нет свежих новостей
18. На основе функции start() сделаем функцию дающую нам клавиатуру по команде /start
19. Создадим список start_buttons с названиями кнопок ["Все новости", "Последние 5 новостей", "Свежие новости"]
20. Создаём объект клавиатуры: keyboard и добавляем в неё наш список кнопок
21. Ответ на команду /start:  Лента новостей - название клавиатуры
22. Привяжем обработчики к кнопкам, импортируем from aiogram.dispatcher.filters import Text
23. Заменим вызов команд в каждой функции: 
                                                @dp.message_handler(Text(equals="Все новости"))
                                                @dp.message_handler(Text(equals="Последние 5 новостей"))
                                                @dp.message_handler(Text(equals="Свежие новости"))
24. Настроим бота, чтобы парсил новости раз в минуту и выводил на экран, создадим функцию - news_every_minute()
25. В цикле While создаём условия для обнаружения новых новостей
26. loop - вернёт текущий цикл событий
27. С помощью create_task() создадим новую задачу